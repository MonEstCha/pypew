{% extends 'base.html' %}
{% block title %}Pew Sheet{% endblock %}

{% block content %}
    {% if service %}
        {% include 'serviceDetails.html' %}
    {% endif %}

    <div class="container">
        {% include 'serviceForm.html' %}
    </div>
{% endblock %}

{% block sidebar %}
    <h2>Recent services</h2>
    <ul class="list-unstyled">
        <li>(<a id="clearHistLink" href="#" class="link-warning text-decoration-none">clear history</a>)</li>
        {% for args, ps in previous_services %}
            <li class="previous-service">
                <a href="{{ url_for('pew_sheet_create_view') }}?{{args}}"
                   class="link-secondary text-decoration-none">
                    {{ ps | service_summary }}
                </a>
            </li>
        {% endfor %}
    </ul>

    <script>
        const clearHistLink = document.getElementById('clearHistLink');
        clearHistLink.onclick = () => {
            if (!confirm('Clear pew sheet history? This cannot be undone!')) {
                return;
            }
            fetch("{{ url_for('pew_sheet_clear_history_endpoint') }}",
                {
                    method: 'delete'
                }
            ).then((r) =>
                {
                    document.querySelectorAll('li.previous-service').forEach((e) => {e.remove()});
                    notify({message: 'History cleared.', color: 'success', timeout: 2000});
                }
            );
        };
    </script>
{% endblock %}
